import "./modulepreload-polyfill-B5Qt9EMX.js";
import { j as d, c as O } from "./client-D0qgw5AI.js";
/* empty css                 */ import { r as C } from "./index-D91ASeLC.js";
import { L as X, p as x } from "./usePostToIframe-CYLIRhxM.js";
import { E as _, g as G, a as M } from "./actions-CxosgIhI.js";
import "./_commonjsHelpers-BosuxZz1.js";

console.log("[TREX Popup] ğŸš€ Initializing popup interface");
console.log("[TREX Popup] ğŸ“± Running in popup mode instead of sidepanel");
const Y = "Loading",
  v = 0,
  U = 1080,
  B = 1920,
  b = { g: "@lottiefiles/toolkit-js 0.63.1", tc: "#ffffff" },
  j = JSON.parse(
    '[{"ty":3,"nm":"","sr":1,"st":0,"op":31,"ip":0,"ln":"857","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[680,680,101.493]},"p":{"a":1,"k":[{"o":{"x":0.333,"y":0},"i":{"x":0.667,"y":1},"s":[2408,3462,0],"t":0},{"o":{"x":0.333,"y":0},"i":{"x":0.667,"y":1},"s":[2408,3450,0],"t":14},{"s":[2408,3462,0],"t":30}]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"ind":1},{"ty":4,"nm":"Norse ans Mouth","sr":1,"st":0,"op":31,"ip":0,"ln":"854","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100,100]},"p":{"a":0,"k":[-223.912,-342.637,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Shape 6","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":false,"i":[[0,0],[-18.515,-0.513],[0,0]],"o":[[0,0],[18.516,0.512],[0,0]],"v":[[-28.931,55.192],[1.281,65.296],[28.931,58.648]]}}},{"ty":"st","nm":"Stroke 1","lc":2,"lj":2,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,-2.5]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 5","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":false,"i":[[0,0],[14.107,-16.971],[-20.6,-6.808],[-10.704,-1.912],[-4.279,20.683]],"o":[[0,0],[-8.623,10.374],[19.324,6.386],[10.704,1.911],[0,0]],"v":[[-16.766,-31.348],[-44.628,-9.671],[-38.654,29.705],[-1.661,29.055],[54.754,17.165]]}}},{"ty":"st","nm":"Stroke 1","lc":2,"lj":2,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,2.778]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 2","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":false,"i":[[0,0],[1.085,-3.863]],"o":[[0,0],[0,0]],"v":[[14.723,-8.05],[5.902,-1.075]]}}},{"ty":"st","nm":"Stroke 1","lc":2,"lj":2,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0]}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[0,0,0]},"r":1,"o":{"a":0,"k":100}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 1","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":false,"i":[[0,0],[-1.411,-3.944]],"o":[[0,0],[0,0]],"v":[[-27.481,-7.201],[-20.519,-0.799]]}}},{"ty":"st","nm":"Stroke 1","lc":2,"lj":2,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":8},"c":{"a":0,"k":[0,0,0]}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[0,0,0]},"r":1,"o":{"a":0,"k":100}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]}],"ind":2,"parent":1},{"ty":3,"nm":"","sr":1,"st":0,"op":31,"ip":0,"ln":"861","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[33.333,33.333,100]},"p":{"a":0,"k":[-268,-399.378,0]},"r":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[20],"t":0},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[75],"t":5},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[200],"t":10},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[370],"t":15},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[540],"t":20},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[650],"t":25},{"s":[710],"t":30}]},"o":{"a":0,"k":100}},"ind":3,"parent":1},{"ty":4,"nm":"Eye Left","sr":1,"st":0,"op":31,"ip":0,"ln":"853","tt":1,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[300,300,100]},"p":{"a":0,"k":[5,-71,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Shape 2","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,-3.074],[3.074,0],[0,3.075],[-3.074,0]],"o":[[0,3.075],[-3.074,0],[0,-3.074],[3.074,0]],"v":[[-5.183,-7.5],[-10.75,-1.933],[-16.317,-7.5],[-10.75,-13.067]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":0},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 1","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[3.557,13.277],[13.277,-3.557],[-3.558,-13.277],[-13.277,3.557]],"o":[[-3.558,-13.277],[-13.277,3.557],[3.558,13.277],[13.277,-3.558]],"v":[[24.04,-6.442],[-5.63,-21.012],[-24.04,6.441],[5.63,21.012]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":0},"c":{"a":0,"k":[0,0,0]}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[0,0,0]},"r":1,"o":{"a":0,"k":100}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]}],"ind":4,"parent":3,"tp":8},{"ty":3,"nm":"","sr":1,"st":0,"op":31,"ip":0,"ln":"859","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[33.333,33.333,100]},"p":{"a":0,"k":[-165.667,-398.044,0]},"r":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[20],"t":0},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[75],"t":5},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[200],"t":10},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[370],"t":15},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[540],"t":20},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[650],"t":25},{"s":[710],"t":30}]},"o":{"a":0,"k":100}},"ind":5,"parent":1},{"ty":4,"nm":"Eye Right","sr":1,"st":0,"op":31,"ip":0,"ln":"852","tt":1,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[300,300,100]},"p":{"a":0,"k":[8.833,-65.833,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Shape 2","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,-3.074],[3.074,0],[0,3.075],[-3.074,0]],"o":[[0,3.075],[-3.074,0],[0,-3.074],[3.074,0]],"v":[[-5.183,-7.5],[-10.75,-1.933],[-16.317,-7.5],[-10.75,-13.067]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":0},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[-3,-0.5]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 1","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[3.557,13.277],[13.277,-3.557],[-3.558,-13.277],[-13.277,3.557]],"o":[[-3.558,-13.277],[-13.277,3.557],[3.558,13.277],[13.277,-3.558]],"v":[[24.04,-6.442],[-5.63,-21.012],[-24.04,6.441],[5.63,21.012]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":0},"c":{"a":0,"k":[0,0,0]}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[0,0,0]},"r":1,"o":{"a":0,"k":100}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[-3,-0.5]},"r":{"a":0,"k":30.042},"o":{"a":0,"k":100}}]}],"ind":6,"parent":5,"tp":8},{"ty":4,"nm":"Eye 2","sr":1,"st":0,"op":31,"ip":0,"ln":"886","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100,100]},"p":{"a":0,"k":[-267,-403.417,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Shape 2","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[0.001,0],[2.917,0.781],[-2.848,10.63],[-10.96,0],[-2.917,-0.781],[2.848,-10.631],[10.959,0]],"o":[[-2.808,0],[-17.044,-4.566],[2.672,-9.972],[2.807,0],[17.044,4.566],[-2.671,9.971],[-0.001,0]],"v":[[104.779,23.784],[96.152,22.606],[77.201,-5.361],[98.972,-21.285],[107.598,-20.107],[126.548,7.861],[104.78,23.784]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":6},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 1","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[0.001,0],[2.524,9.416],[-16.106,4.319],[-2.655,0],[-2.524,-9.417],[3.419,-4.804],[6.52,-1.748],[2.654,0]],"o":[[-10.353,-0.001],[-2.69,-10.04],[2.759,-0.74],[10.354,0],[1.624,6.061],[-3.26,4.581],[-2.76,0.74],[-0.001,0]],"v":[[-2.688,21.286],[-23.251,6.248],[-5.339,-20.171],[2.82,-21.285],[23.384,-6.247],[20.639,10.36],[5.472,20.171],[-2.686,21.286]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":6},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]}],"ind":7,"parent":1},{"ty":4,"nm":"Eye","sr":1,"st":0,"op":31,"ip":0,"ln":"851","hasMask":false,"td":1,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100,100]},"p":{"a":0,"k":[-267,-403.417,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Shape 2","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[0.001,0],[2.549,0.683],[-2.488,9.286],[-9.575,0],[-2.549,-0.683],[2.488,-9.287],[9.574,0]],"o":[[-2.453,0],[-14.89,-3.989],[2.334,-8.712],[2.453,0],[14.89,3.989],[-2.334,8.711],[-0.001,0]],"v":[[104.412,20.937],[96.875,19.907],[80.319,-4.525],[99.338,-18.437],[106.875,-17.408],[123.431,7.025],[104.413,20.937]]}}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[1,1,1]},"r":1,"o":{"a":0,"k":100}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":12},"c":{"a":0,"k":[0.6196,0.8078,0.5373]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 1","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,0],[2.208,8.24],[-14.096,3.777],[-2.323,0],[-2.207,-8.241],[2.993,-4.204],[5.706,-1.528],[2.322,0]],"o":[[-9.061,-0.001],[-2.354,-8.786],[2.414,-0.648],[9.061,0],[1.422,5.304],[-2.853,4.009],[-2.415,0.648],[-0.001,0]],"v":[[-2.41,18.628],[-20.406,5.468],[-4.73,-17.652],[2.409,-18.627],[20.405,-5.467],[18.003,9.066],[4.73,17.652],[-2.409,18.628]]}}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[1,1,1]},"r":1,"o":{"a":0,"k":100}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":12},"c":{"a":0,"k":[0.6196,0.8078,0.5373]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]}],"ind":8,"parent":1},{"ty":4,"nm":"Brown","sr":1,"st":0,"op":31,"ip":0,"ln":"850","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100,100]},"p":{"a":0,"k":[43.75,-39.765,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Shape 2","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[-4.242,-1.264],[0.794,0.662],[8.933,1.093],[4.283,-2.675],[-1.04,0.195],[-7.523,-1.2]],"o":[[0.991,0.295],[-3.793,-3.164],[-8.715,-1.066],[-0.897,0.561],[4.633,-0.87],[7.578,1.208]],"v":[[81.792,5.841],[82.676,4.2],[62.921,-4.82],[42.427,0.293],[43.097,2.042],[62.841,1.438]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":4},"c":{"a":0,"k":[0,0,0]}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[0,0,0]},"r":1,"o":{"a":0,"k":100}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"gr","nm":"Shape 1","it":[{"ty":"sh","nm":"Path 1","d":1,"ks":{"a":0,"k":{"c":true,"i":[[-3.892,-0.443],[0.794,0.454],[7.954,-0.434],[3.317,-2.996],[-0.875,0.331],[-6.741,0.122]],"o":[[0.91,0.103],[-3.797,-2.168],[-7.759,0.424],[-0.695,0.628],[3.902,-1.477],[6.791,-0.123]],"v":[[-29.672,0.372],[-29.156,-1.196],[-47.77,-5.988],[-64.833,1.649],[-63.979,3.069],[-46.868,-0.523]]}}},{"ty":"st","nm":"Stroke 1","lc":1,"lj":1,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":4},"c":{"a":0,"k":[0,0,0]}},{"ty":"fl","nm":"Fill 1","c":{"a":0,"k":[0,0,0]},"r":1,"o":{"a":0,"k":100}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]}],"ind":9,"parent":8},{"ty":4,"nm":"Shape Layer 2","sr":1,"st":0,"op":31,"ip":0,"ln":"636","hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[16.588,16.588,100]},"p":{"a":0,"k":[-212.941,-371.895,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}},"shapes":[{"ty":"gr","nm":"Ellipse 1","it":[{"ty":"el","nm":"Ellipse Path 1","d":1,"p":{"a":0,"k":[0,0]},"s":{"a":0,"k":[1499.219,1499.219]}},{"ty":"st","nm":"Stroke 1","lc":2,"lj":2,"ml":4,"o":{"a":0,"k":100},"w":{"a":0,"k":80},"c":{"a":0,"k":[0,0,0]}},{"ty":"tr","a":{"a":0,"k":[0,0]},"s":{"a":0,"k":[100,100]},"p":{"a":0,"k":[-4,0]},"r":{"a":0,"k":0},"o":{"a":0,"k":100}}]},{"ty":"tm","nm":"Trim Paths 1","e":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[8],"t":0},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[9],"t":4},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[12],"t":5},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[15],"t":6},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[18],"t":7},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[23],"t":8},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[26],"t":9},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[34],"t":10},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[40],"t":11},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[45],"t":12},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[54],"t":13},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[57],"t":14},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[58],"t":15},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[57],"t":16},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[54],"t":17},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[47],"t":18},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[42],"t":19},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[34],"t":20},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[29],"t":21},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[25],"t":22},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[20],"t":23},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[17],"t":24},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[13],"t":25},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[11],"t":26},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[10],"t":27},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[9],"t":28},{"s":[7],"t":29}]},"o":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[0],"t":0},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[10],"t":1},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[20],"t":2},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[35],"t":3},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[45],"t":4},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[60],"t":5},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[68],"t":6},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[80],"t":7},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[96],"t":8},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[110],"t":9},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[132],"t":10},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[148],"t":11},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[166],"t":12},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[196],"t":13},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[220],"t":14},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[264],"t":15},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[294],"t":16},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[330],"t":17},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[386],"t":18},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[424],"t":19},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[478],"t":20},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[508],"t":21},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[538],"t":22},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[572],"t":23},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[594],"t":24},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[623],"t":25},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[640],"t":26},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[654],"t":27},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[674],"t":28},{"s":[688],"t":29}]},"s":{"a":0,"k":0},"m":1}],"ind":10,"parent":1}]'
  ),
  D = "5.7.0",
  Q = 25,
  F = 31,
  H = 0,
  V = [],
  q = {
    nm: Y,
    ddd: v,
    h: U,
    w: B,
    meta: b,
    layers: j,
    v: D,
    fr: Q,
    op: F,
    ip: H,
    assets: V,
  },
  K = () => {
    chrome.runtime.sendMessage({ type: _.TrexExtensionExplore });
  },
  z = () => {
    chrome.runtime.sendMessage({ type: "get_storage" }, () => {
      chrome.storage.local.get("trex_login_data", (e) => {
        window.postMessage(
          {
            type: "response_storage",
            data: e == null ? void 0 : e.trex_login_data,
          },
          "*"
        );
      });
    });
  },
  J = () => {
    chrome.runtime.sendMessage({ type: _.TrexLoginOut });
  },
  $ = (e) => {
    var a;
    console.log("----trex-extension-login script---", e.data),
      chrome.runtime.sendMessage({
        type: _.LoginCompleted,
        payload: (a = e.data) == null ? void 0 : a.payload,
      });
  },
  Z = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: "TREX_AUTH_BACK",
      payload: (a = e.data) == null ? void 0 : a.payload,
    });
  },
  t0 = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: "TREX_NOTIFICATION_CLICK",
      payload: (a = e.data) == null ? void 0 : a.payload,
    });
  },
  e0 = (e) => {
    chrome.runtime.sendMessage({ type: "TREX_REWARD_UPDATE" });
  },
  a0 = (e) => {
    console.log("----trex-extension-basket-update script---", e.data),
      chrome.runtime.sendMessage({ type: _.RewardUpdate });
  },
  o0 = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: _.TrexExtensionOsDeviceId,
      data: (a = e.data) == null ? void 0 : a.data,
    });
  },
  n0 = () => {
    chrome.runtime.sendMessage({ type: _.TrexGuideStart });
  },
  s0 = () => {
    chrome.runtime.sendMessage({ type: _.TrexGuideHomeClose });
  },
  r0 = () => {
    chrome.runtime.sendMessage({ type: _.TrexGuideRexyClose });
  },
  i0 = (e) => {
    chrome.tabs.query({ active: !0 }, (a) => {
      var c;
      const n = (c = a[0]) == null ? void 0 : c.id;
      console.log("----handleTrexExtensionGetInstallWallet---", n),
        n &&
          chrome.tabs.sendMessage(n, {
            type: "trex_extension_get_InstallWallet",
          });
    });
  },
  l0 = (e) => {
    chrome.tabs.query({ active: !0 }, (a) => {
      var c, E;
      const n = (c = a[0]) == null ? void 0 : c.id;
      console.log("----handleTrexExtensionGetInstallWallet---", e.data),
        n &&
          chrome.tabs.sendMessage(n, {
            type: "trex_extension_wallet_connect",
            payload: (E = e.data) == null ? void 0 : E.data,
          });
    });
  },
  _0 = async (e) => {
    chrome.runtime.sendMessage({ type: "TREX_WALLET_LOGOUT_RESPONSE" });
  },
  y0 = (e) => {
    var n;
    const a = (n = e.data) == null ? void 0 : n.data;
    chrome.runtime.sendMessage({ type: _.TrexTwitterPermSet, data: a });
  },
  x0 = (e) => {
    var n;
    const a = (n = e.data) == null ? void 0 : n.data;
    chrome.runtime.sendMessage({ type: _.TrexYouTubePermSet, data: a });
  },
  c0 = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: "TREX_REQUEST_TYPE_BALANCE",
      data: (a = e.data) == null ? void 0 : a.data,
    });
  },
  d0 = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: "TREX_REQUEST_TYPE_ESTIMATE_GAS",
      data: (a = e.data) == null ? void 0 : a.data,
    });
  },
  E0 = async (e) => {
    var a;
    try {
      await chrome.runtime.sendMessage({
        type: "TREX_REQUEST_TYPE_SEND_TRANSACTION",
        data: (a = e.data) == null ? void 0 : a.data,
      });
    } catch (n) {
      console.log("----handleTrexExtensionSendTransaction---", n);
    }
  },
  m0 = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: "TREX_REQUEST_TYPE_WAIT_FOR_RECEIPT",
      data: (a = e.data) == null ? void 0 : a.data,
    });
  },
  k0 = (e) => {
    var a;
    chrome.runtime.sendMessage({
      type: "TREX_REQUEST_TYPE_GET_ACTIVE_WALLET_CONNECTION_STATUS",
      data: (a = e.data) == null ? void 0 : a.data,
    });
  },
  p0 = (e) => {
    chrome.runtime.sendMessage({ type: "TREX_REQUEST_TYPE_SWITCH_CHAIN" });
  },
  T0 = (e) => {
    chrome.runtime.sendMessage({ type: "TREX_REQUEST_TYPE_GET_GAS_PRICE" });
  },
  f0 = (e) => {
    chrome.runtime.sendMessage({
      type: "TREX_REQUEST_TYPE_GET_INSTALLED_WALLETS",
    });
  },
  h0 = (e) => {
    chrome.runtime.sendMessage({
      type: "TREX_REQUEST_TYPE_GET_ACTIVE_WALLET_ADDRESS",
    });
  },
  S0 = {
    "trex-extension-explore": K,
    request_storage: z,
    "trex-extension-logout": J,
    "trex-extension-login": $,
    "trex-extension-auth": Z,
    "trex-extension-notifications": t0,
    "trex-task-success": e0,
    "trex-extension-basket-update": a0,
    "trex-extension-os-device-id": o0,
    trex_guide_post_start: n0,
    trex_guide_post_home_close: s0,
    trex_guide_post_rexy_close: r0,
    trex_extension_get_InstallWallet: i0,
    trex_extension_wallet_connect: l0,
    trex_extension_wallet_logout_request: _0,
    trex_set_twitter_perm_post: y0,
    trex_set_youtube_perm_post: x0,
    TREX_REQUEST_TYPE_BALANCE: c0,
    TREX_REQUEST_TYPE_ESTIMATE_GAS: d0,
    TREX_REQUEST_TYPE_SEND_TRANSACTION: E0,
    TREX_REQUEST_TYPE_WAIT_FOR_RECEIPT: m0,
    TREX_REQUEST_TYPE_GET_ACTIVE_WALLET_CONNECTION_STATUS: k0,
    TREX_REQUEST_TYPE_SWITCH_CHAIN: p0,
    TREX_REQUEST_TYPE_GET_GAS_PRICE: T0,
    TREX_REQUEST_TYPE_GET_INSTALLED_WALLETS: f0,
    TREX_REQUEST_TYPE_GET_ACTIVE_WALLET_ADDRESS: h0,
  },
  W = async (e) => {
    const { type: a } = e.data || {};
    if (typeof a != "string") return;
    const n = S0[a];
    n ? n(e) : console.warn("Unknown message type:", a);
  };
function u0() {
  const [e, a] = C.useState(!0),
    n = G().iframeUrl,
    c = async () => {
      const o = document.getElementById("trex-iframe");
      chrome.storage.local.get("trex_auth_data", (t) => {
        x(o, "TREX_IFRAME_AUTH_SUCCESS", t);
      }),
        chrome.storage.local.get("trex_twitter_permission", (t) => {
          const y = t == null ? void 0 : t.trex_twitter_permission;
          x(o, "IframePermRespTwitter", y);
        }),
        chrome.storage.local.get("trex_youtube_permission", (t) => {
          const y = t == null ? void 0 : t.trex_youtube_permission;
          x(o, "IframePermRespYoutube", y);
        });
    },
    E = () => {
      chrome.storage.local.get("trex_wallet_connect_state", (o) => {
        var t;
        o != null &&
          o.trex_wallet_connect_state &&
          ((t = document.getElementById("trex-iframe").contentWindow) == null ||
            t.postMessage(
              {
                type: "trex_extension_pannel_wallet_connect_status_response",
                data: o.trex_wallet_connect_state,
              },
              "*"
            ));
      });
    },
    m = () => {
      chrome.storage.local.get("trex_login_data", (o) => {
        var t;
        o != null &&
          o.trex_login_data &&
          ((t = document.getElementById("trex-iframe").contentWindow) == null ||
            t.postMessage(
              {
                type: "trex_extension_pannel_trex_token_response",
                data: o.trex_login_data.token,
              },
              "*"
            ));
      });
    },
    k = () => {
      chrome.storage.local.get("trex_login_type", (o) => {
        var t;
        o != null &&
          o.trex_login_type &&
          ((t = document.getElementById("trex-iframe").contentWindow) == null ||
            t.postMessage(
              {
                type: "trex_extension_pannel_wallet_connect_login_type_response",
                data: o.trex_login_type,
              },
              "*"
            ));
      });
    },
    p = () => {
      a(!1), c(), E(), m(), k();
    },
    T = (o, t) => {
      var y, r;
      if (t === "local" && o.trex_auth_data) {
        const i = (y = o.trex_auth_data) == null ? void 0 : y.newValue;
        console.log("auth data send iframe data:", i);
        const l = document.getElementById("trex-iframe");
        l &&
          l.contentWindow &&
          i &&
          (x(l, "TREX_IFRAME_AUTH_SUCCESS", i),
          chrome.storage.local.remove("trex_auth_data"));
      }
      if (
        (t === "local" && o.trex_wallet_connect_state && E(),
        t === "local" && o.trex_login_data && m(),
        t === "local" && (r = o.trex_login_type) != null && r.newValue)
      ) {
        if ((k(), o.trex_twitter_permission)) {
          const i = document.getElementById("trex-iframe"),
            l = o.trex_twitter_permission.newValue;
          x(i, "IframePermRespTwitter", l);
        }
        if (o.trex_youtube_permission) {
          const i = document.getElementById("trex-iframe"),
            l = o.trex_youtube_permission.newValue;
          x(i, "IframePermRespYoutube", l);
        }
      }
      if (t === "local" && o.trex_twitter_permission) {
        const i = document.getElementById("trex-iframe"),
          l = o.trex_twitter_permission.newValue;
        x(i, "IframePermRespTwitter", l);
      }
      if (t === "local" && o.trex_youtube_permission) {
        const i = document.getElementById("trex-iframe"),
          l = o.trex_youtube_permission.newValue;
        x(i, "IframePermRespYoutube", l);
      }
    };
  return (
    C.useEffect(() => {
      const o = document.getElementById("trex-iframe");
      return (
        window.addEventListener("message", W),
        o == null || o.addEventListener("load", p),
        chrome.storage.onChanged.addListener(T),
        chrome.runtime.onMessage.addListener((t, y, r) => {
          // Handle Twitter automation messages from background
          if (t.type === "TREX_TWITTER_LOGIN_REQUIRED") {
            console.log(
              "ğŸ¦ [TREX Automation] Received Twitter login required message"
            );

            // Stop the automation UI using stored state
            if (t.stopAutomation) {
              console.log(
                "ğŸ›‘ [TREX Automation] Stopping automation UI due to login requirement"
              );

              // Update stored state and UI
              chrome.storage.local.set({
                trex_automation_running: false,
                trex_automation_stopped: true,
                trex_twitter_login_required: true,
              });

              // Update local variable if accessible
              if (typeof window.setAutomationRunning === "function") {
                window.setAutomationRunning(false);
              }

              window.updateToggleAppearance && window.updateToggleAppearance();
            }

            window.showTwitterLoginPopup && window.showTwitterLoginPopup();
            return;
          }

          if (t.type === "TREX_TWITTER_ERROR") {
            console.log(
              "âŒ [TREX Automation] Received Twitter error:",
              t.message
            );
            // Stop automation and show error
            isAutomationRunning = false;
            window.updateToggleAppearance();
            alert("Twitter automation error: " + t.message);
            return;
          }

          // ...existing message handler code...
        }),
        () => {
          o == null || o.removeEventListener("load", p),
            window.removeEventListener("message", W),
            chrome.storage.onChanged.removeListener(T);
        }
      );
    }, []),
    // Add automation toggle functionality
    C.useEffect(() => {
      console.log("ğŸ›ï¸ [TREX Automation] Initializing automation toggle...");

      let isAutomationRunning = false;
      let isLoggedIn = false;

      // Check stored automation state when popup opens
      chrome.storage.local.get(
        [
          "trex_automation_running",
          "trex_automation_stopped",
          "trex_twitter_login_required",
        ],
        (result) => {
          console.log("ğŸ” [TREX Automation] Checked stored state:", result);

          if (result.trex_automation_running === true) {
            console.log(
              "âœ… [TREX Automation] Automation is running - updating UI"
            );
            isAutomationRunning = true;
            window.updateToggleAppearance && window.updateToggleAppearance();
          } else if (result.trex_automation_stopped === true) {
            console.log(
              "ğŸ›‘ [TREX Automation] Automation was stopped - updating UI"
            );
            isAutomationRunning = false;
            window.updateToggleAppearance && window.updateToggleAppearance();
          }

          if (result.trex_twitter_login_required === true) {
            console.log(
              "ğŸ¦ [TREX Automation] Twitter login required - showing popup"
            );
            window.showTwitterLoginPopup && window.showTwitterLoginPopup();
          }
        }
      );

      // Make functions available globally on window for React to access
      window.handleToggleClick = async (event) => {
        console.log(
          "ğŸ¯ [TREX Automation] ====================================="
        );
        console.log("ğŸ¯ [TREX Automation] BUTTON CLICKED! Event:", event);
        console.log(
          "ğŸ¯ [TREX Automation] ====================================="
        );
        console.log(
          "ğŸ¯ [TREX Automation] Toggle clicked, current state:",
          isAutomationRunning
        );

        try {
          if (isAutomationRunning) {
            // Stop automation
            console.log("ğŸ›‘ [TREX Automation] Stopping Twitter automation...");

            // Stop Twitter automation via background script
            chrome.runtime.sendMessage(
              { type: "TREX_STOP_TWITTER_AUTOMATION" },
              (response) => {
                console.log("ğŸ›‘ [TREX Automation] Stop response:", response);
                isAutomationRunning = false;

                // Update stored state when manually stopping
                chrome.storage.local.set({
                  trex_automation_running: false,
                  trex_automation_stopped: true,
                  trex_twitter_login_required: false,
                  trex_last_error: null,
                });

                window.updateToggleAppearance();
                console.log("ğŸ›‘ [TREX Automation] Twitter automation stopped");
              }
            );
          } else {
            // Try to start automation
            console.log(
              "ğŸš€ [TREX Automation] Attempting to start automation..."
            );

            // Do comprehensive login check before starting
            console.log("ğŸ” [TREX Automation] Checking login status...");
            await window.checkLoginStatus();
            console.log(
              "ğŸ” [TREX Automation] Login status check completed, isLoggedIn:",
              isLoggedIn
            );

            if (isLoggedIn) {
              // User is logged in to TREX - start Twitter automation
              console.log(
                "âœ… [TREX Automation] TREX auth confirmed, starting Twitter automation..."
              );

              // Start Twitter automation via background script
              console.log(
                "ğŸ“¤ [TREX Automation] Sending start message to background..."
              );
              chrome.runtime.sendMessage(
                { type: "TREX_START_TWITTER_AUTOMATION" },
                (response) => {
                  console.log(
                    "ğŸ“¥ [TREX Automation] Background response:",
                    response
                  );
                  if (response && response.success) {
                    isAutomationRunning = true;

                    // Clear any stored error states since automation started successfully
                    chrome.storage.local.set({
                      trex_automation_running: true,
                      trex_automation_stopped: false,
                      trex_twitter_login_required: false,
                      trex_last_error: null,
                    });

                    window.updateToggleAppearance();
                    console.log(
                      "âœ… [TREX Automation] Twitter automation started successfully"
                    );
                  } else {
                    console.log(
                      "âŒ [TREX Automation] Twitter automation failed to start:",
                      response
                    );
                    window.showTwitterLoginPopup();
                  }
                }
              );
            } else {
              // User is not logged in - show popup and keep toggle off
              console.log("âŒ [TREX Automation] Not logged in - showing popup");
              window.showLoginPopup();
            }
          }
        } catch (error) {
          console.error(
            "ğŸ’¥ [TREX Automation] Error in handleToggleClick:",
            error
          );
        }

        console.log(
          "ğŸ¯ [TREX Automation] ====================================="
        );
        console.log("ğŸ¯ [TREX Automation] Button click handler completed");
        console.log(
          "ğŸ¯ [TREX Automation] ====================================="
        );
      };

      // Make automation state setter available globally
      window.setAutomationRunning = (state) => {
        console.log(
          `ğŸ”„ [TREX Automation] Setting automation running state to: ${state}`
        );
        isAutomationRunning = state;
      };

      // Make hideLoginPopup available globally
      window.hideLoginPopup = () => {
        const loginPopupOverlay = document.getElementById("loginPopupOverlay");
        if (loginPopupOverlay) {
          // Add fade-out animation
          loginPopupOverlay.style.animation = "popupFadeOut 0.2s ease-in";

          // Hide after animation completes
          setTimeout(() => {
            loginPopupOverlay.classList.add("hidden");
            loginPopupOverlay.style.display = "none";
            loginPopupOverlay.style.visibility = "hidden";
            loginPopupOverlay.style.opacity = "0";
          }, 200);

          console.log("âœ–ï¸ [TREX Automation] Login popup closed");
        }
      };

      // Make helper functions available globally too
      window.showLoginPopup = () => {
        console.log("ğŸ” [TREX Automation] Attempting to show login popup...");

        const loginPopupOverlay = document.getElementById("loginPopupOverlay");
        console.log(
          "ğŸ¯ [TREX Automation] Found popup element:",
          !!loginPopupOverlay
        );

        if (loginPopupOverlay) {
          console.log("ğŸš¨ [TREX Automation] Showing login required popup");

          // Remove hidden class AND force display with inline styles
          loginPopupOverlay.classList.remove("hidden");
          loginPopupOverlay.style.display = "flex";
          loginPopupOverlay.style.visibility = "visible";
          loginPopupOverlay.style.opacity = "1";
          loginPopupOverlay.style.animation = "popupFadeIn 0.3s ease-out";

          // Add animation to the inner popup
          const popupContent = loginPopupOverlay.querySelector("div");
          if (popupContent) {
            popupContent.style.animation = "popupSlideIn 0.3s ease-out";
          }

          // Double check that it's visible
          setTimeout(() => {
            const computedDisplay =
              window.getComputedStyle(loginPopupOverlay).display;
            const isVisible = !loginPopupOverlay.classList.contains("hidden");
            console.log(
              "âœ… [TREX Automation] Popup visibility confirmed:",
              isVisible
            );
            console.log(
              "âœ… [TREX Automation] Computed display:",
              computedDisplay
            );
          }, 100);
        } else {
          console.error(
            "âŒ [TREX Automation] Could not find loginPopupOverlay element!"
          );

          // Try again after a short delay for React rendering
          setTimeout(() => {
            const retryElement = document.getElementById("loginPopupOverlay");
            if (retryElement) {
              console.log(
                "ğŸ”„ [TREX Automation] Retry successful - showing popup"
              );
              retryElement.classList.remove("hidden");
              retryElement.style.display = "flex";
              retryElement.style.visibility = "visible";
              retryElement.style.opacity = "1";
              retryElement.style.animation = "popupFadeIn 0.3s ease-out";

              const popupContent = retryElement.querySelector("div");
              if (popupContent) {
                popupContent.style.animation = "popupSlideIn 0.3s ease-out";
              }
            } else {
              console.error(
                "ğŸ’¥ [TREX Automation] Retry failed - popup element still not found"
              );
            }
          }, 500);
        }
      };

      window.showTwitterLoginPopup = () => {
        console.log(
          "ğŸ” [TREX Automation] Attempting to show Twitter login popup..."
        );

        const loginPopupOverlay = document.getElementById("loginPopupOverlay");
        console.log(
          "ğŸ¯ [TREX Automation] Found popup element:",
          !!loginPopupOverlay
        );

        if (loginPopupOverlay) {
          // Update popup content for Twitter login
          const popupTitle = loginPopupOverlay.querySelector("h3");
          const popupMessage = loginPopupOverlay.querySelector("p");

          if (popupTitle) popupTitle.textContent = "Twitter Login Required";
          if (popupMessage)
            popupMessage.textContent =
              "Please log into Twitter (X) to continue automation. This extension needs access to your Twitter account for automated scrolling.";

          console.log(
            "ğŸ¦ [TREX Automation] Showing Twitter login required popup"
          );

          // Remove hidden class AND force display with inline styles
          loginPopupOverlay.classList.remove("hidden");
          loginPopupOverlay.style.display = "flex";
          loginPopupOverlay.style.visibility = "visible";
          loginPopupOverlay.style.opacity = "1";

          // Double check that it's visible
          setTimeout(() => {
            const computedDisplay =
              window.getComputedStyle(loginPopupOverlay).display;
            const isVisible = !loginPopupOverlay.classList.contains("hidden");
            console.log(
              "âœ… [TREX Automation] Twitter popup visibility confirmed:",
              isVisible
            );
            console.log(
              "âœ… [TREX Automation] Computed display:",
              computedDisplay
            );
          }, 100);
        } else {
          console.error(
            "âŒ [TREX Automation] Could not find loginPopupOverlay element for Twitter popup!"
          );

          // Try again after a short delay for React rendering
          setTimeout(() => {
            const retryElement = document.getElementById("loginPopupOverlay");
            if (retryElement) {
              console.log(
                "ğŸ”„ [TREX Automation] Twitter popup retry successful"
              );
              const popupTitle = retryElement.querySelector("h3");
              const popupMessage = retryElement.querySelector("p");

              if (popupTitle) popupTitle.textContent = "Twitter Login Required";
              if (popupMessage)
                popupMessage.textContent =
                  "Please log into Twitter (X) to continue automation. This extension needs access to your Twitter account for automated scrolling.";

              retryElement.classList.remove("hidden");
              retryElement.style.display = "flex";
              retryElement.style.visibility = "visible";
              retryElement.style.opacity = "1";
            } else {
              console.error(
                "ğŸ’¥ [TREX Automation] Twitter popup retry failed - element still not found"
              );
            }
          }, 500);
        }
      };

      window.updateToggleAppearance = () => {
        const automationToggle = document.getElementById("automationToggle");
        const toggleIcon = document.getElementById("toggleIcon");
        const toggleText = document.getElementById("toggleText");

        if (!automationToggle || !toggleIcon || !toggleText) return;

        // Remove all classes
        automationToggle.classList.remove("running", "error");
        toggleIcon.classList.remove("running");

        // Check stored state as backup if local variable seems incorrect
        chrome.storage.local.get(["trex_automation_running"], (result) => {
          const storedRunning = result.trex_automation_running === true;
          const actuallyRunning = isAutomationRunning || storedRunning;

          console.log(
            `ğŸ” [TREX Automation] UI State Check - Local: ${isAutomationRunning}, Stored: ${storedRunning}, Final: ${actuallyRunning}`
          );

          if (actuallyRunning) {
            automationToggle.classList.add("running");
            toggleIcon.classList.add("running");
            toggleText.textContent = "Automation Running";
            console.log("ğŸŸ¢ [TREX Automation] UI: RUNNING");

            // Sync local variable with stored state
            isAutomationRunning = true;
          } else {
            toggleText.textContent = "Start Automation";
            console.log("âšª [TREX Automation] UI: STOPPED");

            // Sync local variable with stored state
            isAutomationRunning = false;
          }
        });
      };

      // Check if iframe URL indicates login page (CORRECTED LOGIC)
      const checkIframeURL = () => {
        return new Promise((resolve) => {
          try {
            const iframe = document.getElementById("trex-iframe");
            if (!iframe) {
              console.log("âš ï¸ [TREX Automation] Iframe not found");
              resolve(false);
              return;
            }

            // Get the iframe's current URL
            let iframeURL = "";
            try {
              // Try to get URL directly (may fail due to cross-origin)
              iframeURL = iframe.contentWindow.location.href;
            } catch (crossOriginError) {
              // Fallback: check the src attribute
              iframeURL = iframe.src || "";
            }

            console.log("ğŸ”— [TREX Automation] Current iframe URL:", iframeURL);

            // CORRECTED LOGIC: /extension is the LOGIN PAGE
            // User is logged in if URL does NOT end with /extension
            const isOnLoginPage =
              iframeURL.endsWith("/extension") ||
              iframeURL.includes("/extension?") ||
              iframeURL.includes("/extension#") ||
              /\/extension\/?(?:\?.*)?(?:#.*)?$/.test(iframeURL);

            // Check for known logged-in page patterns
            // SIMPLE LOGIC: If URL ends with /extension â†’ NOT logged in
            // If URL ends with anything else â†’ User IS logged in

            // User is logged in if NOT on the /extension login page
            const isLoggedInByURL = !isOnLoginPage;

            console.log(
              "ï¿½ [TREX Automation] Is on login page (/extension):",
              isOnLoginPage
            );
            console.log(
              "ğŸ¯ [TREX Automation] Is on known logged-in page:",
              isOnKnownLoggedInPage
            );
            console.log(
              "âœ… [TREX Automation] URL indicates logged in:",
              isLoggedInByURL
            );

            resolve(isLoggedInByURL);
          } catch (error) {
            console.log(
              "âŒ [TREX Automation] Error checking iframe URL:",
              error
            );
            resolve(false);
          }
        });
      };

      // Check if user is logged in from storage
      window.checkStorageAuth = () => {
        return new Promise((resolve) => {
          chrome.storage.local.get(
            ["trex_login_data", "trex_auth_data"],
            (result) => {
              console.log("ğŸ“Š [TREX Automation] Storage data:", result);

              const loginData = result.trex_login_data;
              const authData = result.trex_auth_data;

              // Check if user has valid auth token
              const hasValidAuth = !!(
                (loginData && loginData.token && loginData.token.accessToken) ||
                (authData && authData.token)
              );

              console.log("ğŸ” [TREX Automation] Authentication details:");
              console.log("   ğŸ“¦ Login data exists:", !!loginData);
              if (loginData) {
                console.log("   ğŸ”‘ Login token exists:", !!loginData.token);
                if (loginData.token) {
                  console.log(
                    "   âœ… Access token exists:",
                    !!loginData.token.accessToken
                  );
                }
              }
              console.log("   ğŸ“¦ Auth data exists:", !!authData);
              if (authData) {
                console.log("   ğŸ”‘ Auth token exists:", !!authData.token);
              }
              console.log("   ğŸ¯ Final auth status:", hasValidAuth);

              resolve(hasValidAuth);
            }
          );
        });
      };

      // Check iframe content for login indicators (ENHANCED)
      const checkIframeContent = () => {
        return new Promise((resolve) => {
          try {
            const iframe = document.getElementById("trex-iframe");
            if (!iframe || !iframe.contentWindow) {
              console.log(
                "âš ï¸ [TREX Automation] Iframe not available for content check"
              );
              resolve(true); // Assume logged in if can't check
              return;
            }

            try {
              const iframeDoc =
                iframe.contentDocument || iframe.contentWindow.document;
              if (iframeDoc) {
                // More comprehensive login form detection
                const loginSelectors = [
                  'input[type="email"]',
                  'input[type="password"]',
                  '[data-testid*="login"]',
                  '[data-testid*="signin"]',
                  ".login-form",
                  ".sign-in-form",
                  ".auth-form",
                  '[class*="login"]',
                  '[class*="signin"]',
                  '[class*="auth"]',
                  'button[type="submit"]', // Common in login forms
                ];

                const loginElements = loginSelectors.reduce(
                  (count, selector) => {
                    return count + iframeDoc.querySelectorAll(selector).length;
                  },
                  0
                );

                // Check for login-related text content
                const bodyText = iframeDoc.body
                  ? iframeDoc.body.innerText.toLowerCase()
                  : "";
                const loginTextIndicators = [
                  "login or sign up",
                  "sign in",
                  "sign up",
                  "create account",
                  "connect wallet",
                  "email address",
                  "password",
                  "forgot password",
                ];

                const hasLoginText = loginTextIndicators.some((text) =>
                  bodyText.includes(text)
                );

                // Check for logged-in indicators
                const loggedInIndicators = [
                  "dashboard",
                  "profile",
                  "logout",
                  "sign out",
                  "settings",
                  "account",
                  "welcome back",
                  "balance",
                  "rewards",
                ];

                const hasLoggedInText = loggedInIndicators.some((text) =>
                  bodyText.includes(text)
                );

                const hasLoginContent =
                  (loginElements > 0 || hasLoginText) && !hasLoggedInText;

                console.log("ï¿½ [TREX Automation] Content analysis:");
                console.log("   ğŸ” Login elements found:", loginElements);
                console.log("   ğŸ“ Has login text:", hasLoginText);
                console.log("   âœ… Has logged-in text:", hasLoggedInText);
                console.log("   ğŸš¨ Has login content:", hasLoginContent);

                // Return true if NO login content (meaning user is logged in)
                resolve(!hasLoginContent);
              } else {
                console.log(
                  "ğŸ“„ [TREX Automation] Cannot access iframe document"
                );
                resolve(true); // Assume logged in if can't check
              }
            } catch (crossOriginError) {
              // Cross-origin restrictions - assume valid session
              console.log(
                "ï¿½ [TREX Automation] Cross-origin content check - assuming logged in"
              );
              resolve(true);
            }
          } catch (error) {
            console.log(
              "âŒ [TREX Automation] Error checking iframe content:",
              error
            );
            resolve(true); // Assume logged in if error occurs
          }
        });
      };

      // Comprehensive login status check (IMPROVED LOGIC)
      window.checkLoginStatus = async () => {
        console.log(
          "ğŸ” [TREX Automation] Starting comprehensive login check..."
        );

        try {
          // Simple auth check - only check storage auth token
          const storageAuth = await window.checkStorageAuth();

          console.log("ğŸ“Š [TREX Automation] Authentication status:");
          console.log("   ğŸ” Storage auth token:", storageAuth);

          // SIMPLE LOGIC: Only check if auth token exists in storage
          const wasLoggedIn = isLoggedIn;
          isLoggedIn = storageAuth;

          console.log("ğŸ¯ [TREX Automation] FINAL LOGIN STATUS:", isLoggedIn);

          // If user was logged in but now isn't, stop automation
          if (wasLoggedIn && !isLoggedIn && isAutomationRunning) {
            console.log(
              "ğŸš¨ [TREX Automation] Session expired - stopping automation"
            );
            isAutomationRunning = false;
            window.updateToggleAppearance();
            window.showSessionExpiredMessage();
          }
        } catch (error) {
          console.log(
            "âŒ [TREX Automation] Error in comprehensive login check:",
            error
          );
          const wasLoggedIn = isLoggedIn;
          isLoggedIn = false;

          // Stop automation if there was an error and user was previously logged in
          if (wasLoggedIn && isAutomationRunning) {
            console.log(
              "ğŸš¨ [TREX Automation] Login check error - stopping automation for safety"
            );
            isAutomationRunning = false;
            window.updateToggleAppearance();
          }
        }
      };

      // Show session expired message
      window.showSessionExpiredMessage = () => {
        console.log(
          "âš ï¸ [TREX Automation] Session expired - showing notification"
        );
        // You could show a toast notification here if needed
      };

      // Update toggle button appearance
      const updateToggleAppearance = () => {
        if (!automationToggle || !toggleIcon || !toggleText) return;

        // Remove all classes
        automationToggle.classList.remove("running", "error");
        toggleIcon.classList.remove("running");

        if (isAutomationRunning) {
          automationToggle.classList.add("running");
          toggleIcon.classList.add("running");
          toggleText.textContent = "Automation Running";
          console.log("ğŸŸ¢ [TREX Automation] UI: RUNNING");
        } else {
          toggleText.textContent = "Start Automation";
          console.log("âšª [TREX Automation] UI: STOPPED");
        }
      };

      // Show login required popup
      const showLoginPopup = () => {
        const loginPopupOverlay = document.getElementById("loginPopupOverlay");
        if (loginPopupOverlay) {
          console.log("ï¿½ [TREX Automation] Showing login required popup");
          loginPopupOverlay.classList.remove("hidden");
        }
      };

      // Show Twitter login required popup
      const showTwitterLoginPopup = () => {
        const loginPopupOverlay = document.getElementById("loginPopupOverlay");
        if (loginPopupOverlay) {
          // Update popup content for Twitter login
          const popupTitle = loginPopupOverlay.querySelector("h3");
          const popupMessage = loginPopupOverlay.querySelector("p");

          if (popupTitle) popupTitle.textContent = "Twitter Login Required";
          if (popupMessage)
            popupMessage.textContent =
              "Please log into Twitter (X) to continue automation. This extension needs access to your Twitter account for automated scrolling.";

          console.log(
            "ğŸ¦ [TREX Automation] Showing Twitter login required popup"
          );
          loginPopupOverlay.classList.remove("hidden");
        }
      };

      // Add CSS styles for automation button states
      const addAutomationStyles = () => {
        const styleId = "trex-automation-styles";
        if (!document.getElementById(styleId)) {
          const style = document.createElement("style");
          style.id = styleId;
          style.textContent = `
            .automation-toggle.running {
              background: linear-gradient(135deg, #10b981, #059669) !important;
              border-color: #10b981 !important;
              animation: pulse-glow 2s infinite !important;
            }
            
            .automation-toggle.running #toggleIcon {
              background: #ffffff !important;
              color: #10b981 !important;
              animation: spin 2s linear infinite !important;
            }
            
            .automation-toggle.running #toggleIcon::before {
              content: "â¸" !important;
            }
            
            .automation-toggle:hover {
              transform: translateY(-1px) !important;
              box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3) !important;
            }
            
            .automation-toggle.running:hover {
              box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4) !important;
            }
            
            .automation-toggle.error {
              background: linear-gradient(135deg, #ef4444, #dc2626) !important;
              border-color: #ef4444 !important;
              animation: shake 0.5s ease-in-out !important;
            }
            
            .hidden {
              display: none !important;
            }
            
            @keyframes pulse-glow {
              0%, 100% { box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2), 0 0 0 0 rgba(16, 185, 129, 0.7); }
              50% { box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2), 0 0 0 10px rgba(16, 185, 129, 0); }
            }
            
            @keyframes spin {
              from { transform: rotate(0deg); }
              to { transform: rotate(360deg); }
            }
            
            @keyframes shake {
              0%, 100% { transform: translateX(0); }
              25% { transform: translateX(-5px); }
              75% { transform: translateX(5px); }
            }
          `;
          document.head.appendChild(style);
        }
      };

      // Add styles immediately
      addAutomationStyles();

      console.log(
        "âœ… [TREX Automation] Event handlers attached via React onClick"
      );

      // Listen for storage changes (when user logs in/out)
      const handleStorageChange = (changes, namespace) => {
        if (namespace === "local") {
          if (changes.trex_login_data || changes.trex_auth_data) {
            console.log(
              "ğŸ”„ [TREX Automation] Auth data changed, rechecking status"
            );
            setTimeout(window.checkLoginStatus, 100);

            // If automation was running and user logs out, stop automation
            if (isAutomationRunning) {
              chrome.storage.local.get(
                ["trex_login_data", "trex_auth_data"],
                (result) => {
                  const loginData = result.trex_login_data;
                  const authData = result.trex_auth_data;

                  const hasValidAuth = !!(
                    (loginData &&
                      loginData.token &&
                      loginData.token.accessToken) ||
                    (authData && authData.token)
                  );

                  if (!hasValidAuth) {
                    isAutomationRunning = false;
                    isLoggedIn = false;
                    window.updateToggleAppearance();
                    console.log(
                      "ğŸš« [TREX Automation] User logged out - automation stopped"
                    );
                  }
                }
              );
            }
          }
        }
      };

      chrome.storage.onChanged.addListener(handleStorageChange);

      // Periodic session monitoring when automation is running
      const sessionCheckInterval = setInterval(async () => {
        if (isAutomationRunning) {
          console.log("ğŸ”„ [TREX Automation] Periodic session check...");
          await window.checkLoginStatus();

          // If session expired and automation was running, it will be stopped by checkLoginStatus
        }
      }, 5000); // Check every 5 seconds when automation is running

      // Initial setup
      (async () => {
        await window.checkLoginStatus();
        window.updateToggleAppearance();
      })();

      // Cleanup
      return () => {
        chrome.storage.onChanged.removeListener(handleStorageChange);

        // Clear the session check interval
        if (sessionCheckInterval) {
          clearInterval(sessionCheckInterval);
        }

        // Stop Twitter automation on cleanup
        if (isAutomationRunning) {
          chrome.runtime.sendMessage({ type: "TREX_STOP_TWITTER_AUTOMATION" });
        }

        console.log("ğŸ§¹ [TREX Automation] Cleanup completed");
      };
    }, []),
    d.jsx("div", {
      style: {
        width: "100%",
        height: "100vh",
        display: "flex",
        flexDirection: "column",
        position: "fixed",
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        zIndex: 1000,
        backgroundColor: "#ffffff",
      },
      children: [
        d.jsx("div", {
          style: {
            position: "relative",
            width: "100%",
            height: "100vh",
            flex: "1 1 auto",
          },
          children: [
            d.jsx("iframe", {
              id: "trex-iframe",
              src: `${n}/extension`,
              style: {
                width: "100%",
                height: "100vh",
                border: "none",
                margin: 0,
                padding: 0,
                display: "block",
                backgroundColor: "#ffffff",
              },
              onLoad: () => {
                console.log("[TREX Popup] âœ… T-Rex iframe loaded successfully");
              },
              onError: (error) => {
                console.error(
                  "[TREX Popup] âŒ T-Rex iframe failed to load:",
                  error
                );
              },
            }),
            // Automation Control Panel - Bottom Right Overlay
            d.jsx("div", {
              style: {
                position: "fixed",
                bottom: "20px",
                right: "20px",
                zIndex: 10001,
              },
              children: [
                // Automation Toggle Button
                d.jsx("button", {
                  id: "automationToggle",
                  onClick: () =>
                    window.handleToggleClick && window.handleToggleClick(event),
                  style: {
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "center",
                    gap: "8px",
                    padding: "12px 24px",
                    borderRadius: "8px",
                    border: "2px solid #6366f1",
                    backgroundColor: "#6366f1",
                    color: "#ffffff",
                    fontFamily: "Poppins, sans-serif",
                    fontSize: "14px",
                    fontWeight: "600",
                    cursor: "pointer",
                    transition: "all 0.3s ease",
                    minWidth: "180px",
                    boxShadow: "0 4px 12px rgba(99, 102, 241, 0.3)",
                  },
                  className: "automation-toggle",
                  children: [
                    d.jsx("div", {
                      id: "toggleIcon",
                      style: {
                        width: "16px",
                        height: "16px",
                        borderRadius: "50%",
                        backgroundColor: "#ffffff",
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "center",
                        fontSize: "10px",
                      },
                      children: "â–¶",
                    }),
                    d.jsx("span", {
                      id: "toggleText",
                      children: "Start Automation",
                    }),
                  ],
                }),
              ],
            }),
          ],
        }),
        // Login Required Popup
        d.jsx("div", {
          id: "loginPopupOverlay",
          className: "hidden",
          style: {
            position: "fixed",
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: "rgba(0, 0, 0, 0.6)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            zIndex: 10002,
            visibility: "visible",
            opacity: 1,
            backdropFilter: "blur(8px)",
          },
          children: d.jsx("div", {
            style: {
              background: "linear-gradient(145deg, #ffffff 0%, #f8fafc 100%)",
              padding: "32px",
              borderRadius: "20px",
              boxShadow:
                "0 25px 50px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1)",
              maxWidth: "420px",
              width: "90%",
              margin: "20px",
              textAlign: "center",
              border: "1px solid rgba(255, 255, 255, 0.2)",
              animation: "popupSlideIn 0.3s ease-out",
            },
            children: [
              // Icon
              d.jsx("div", {
                style: {
                  width: "64px",
                  height: "64px",
                  borderRadius: "50%",
                  background:
                    "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  margin: "0 auto 24px auto",
                  boxShadow: "0 8px 20px rgba(102, 126, 234, 0.3)",
                },
                children: d.jsx("span", {
                  style: {
                    fontSize: "28px",
                    color: "#ffffff",
                    fontWeight: "bold",
                  },
                  children: "ğŸ”",
                }),
              }),
              // Title
              d.jsx("h3", {
                style: {
                  margin: "0 0 16px 0",
                  fontSize: "24px",
                  fontWeight: "700",
                  color: "#1e293b",
                  fontFamily:
                    "Poppins, -apple-system, BlinkMacSystemFont, sans-serif",
                  letterSpacing: "-0.02em",
                },
                children: "Authentication Required",
              }),
              // Message
              d.jsx("p", {
                style: {
                  margin: "0 0 32px 0",
                  fontSize: "16px",
                  color: "#64748b",
                  lineHeight: "1.6",
                  fontFamily:
                    "Poppins, -apple-system, BlinkMacSystemFont, sans-serif",
                  fontWeight: "400",
                },
                children:
                  "Please log into T-Rex to start automation. You need to be authenticated to use automated features.",
              }),
              // Close Button
              d.jsx("button", {
                id: "loginPopupClose",
                onClick: () => window.hideLoginPopup && window.hideLoginPopup(),
                style: {
                  padding: "14px 28px",
                  borderRadius: "12px",
                  border: "2px solid #e2e8f0",
                  backgroundColor: "#ffffff",
                  color: "#64748b",
                  fontSize: "16px",
                  fontWeight: "600",
                  cursor: "pointer",
                  fontFamily:
                    "Poppins, -apple-system, BlinkMacSystemFont, sans-serif",
                  transition: "all 0.2s ease",
                  minWidth: "120px",
                  margin: "0 auto",
                  display: "block",
                },
                onMouseOver: (e) => {
                  e.target.style.borderColor = "#cbd5e1";
                  e.target.style.backgroundColor = "#f8fafc";
                  e.target.style.transform = "translateY(-1px)";
                },
                onMouseOut: (e) => {
                  e.target.style.borderColor = "#e2e8f0";
                  e.target.style.backgroundColor = "#ffffff";
                  e.target.style.transform = "translateY(0)";
                },
                children: "Close",
              }),
            ],
          }),
        }),
      ],
    })
  );
}
function g0() {
  console.log("[TREX Popup] ğŸ” Looking for popup root element");
  const e = document.querySelector("#__root");
  if (!e) {
    console.error("[TREX Popup] âŒ Can't find popup root element");
    throw new Error("Can't find Panel root element");
  }
  console.log("[TREX Popup] âœ… Found popup root element, rendering React app");
  O.createRoot(e).render(d.jsx(u0, {}));
  console.log("[TREX Popup] ğŸ‰ Popup React app rendered successfully");
}
console.log("[TREX Popup] ğŸš€ Starting popup initialization");
g0();
console.log("[TREX Popup] âœ… Popup initialization complete");
